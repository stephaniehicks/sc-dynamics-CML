---
title: Analysis of scATAC-seq data from CML patient 0114
author: Yuchao Jiang
output: 
    html_document:
        theme: cosmo 
        toc: true
        toc_float: true
        highlight: tango
        number_sections: false
fig_width: 5
fig_height: 5 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Summary of patient data

This is scATAC-seq (10X Genomics platform) data from a MPN patient 
(denoted `0114` patient) from Jan 14, 2019. The following files are in the folder, which are used as input for [Destin](https://github.com/urrutiag/destin) : 

- `matrix.mtx`: peak by cell chromatin accessiblilty matrix in MatrixMarket format. We can use R package “Matrix” to read straight to a sparse matrix
- `peaks.bed`:  bed file corresponding to rows of matrix.mtx
- `barcodes.tsv`: barcodes corresponding to columns of matrix.mtx.



## Load data
Read in data and store as ranged summarized experiment (rse)
```{r load-data, message=FALSE, cache=TRUE, eval=FALSE}
library(destin)
data10xDir='BM_CD34/filtered_peak_bc_matrix/'
rse = createRSEfrom10xMatrix(data10xDir)
colData(rse) # cells
rowRanges(rse) # peaks
assay(rse)[1:10,1:10]
```

## Annotate peaks
```{r annotate, message=FALSE, cache=TRUE, eval=FALSE}
model = "hg19"
rse = annotateRSE(rse, model)
```

## Quality control
```{r qc, message=FALSE, cache=TRUE, eval=FALSE}
rse = doQC(rse, regionSumCutoff = 5, cellSumCutoffSDs = 3)
```

## Estimate number of clusters
```{r estimate.cluster, message=FALSE, cache=TRUE, eval=FALSE}
clusterEst = estimateNClusters(rse, nClustersRange = 2:20)
nClusters = clusterEst$nClustersList$logLikeElbow
plotNClusters(clusterEst)
```

## Cluster
```{r cluster, message=FALSE, cache=TRUE, eval=FALSE}
nCores = 3
clusterResults = destinGrid (rse, nClusters = nClusters, nCores = nCores)
clusterResults$cluster
```

## Plot clustering results
```{r plot.cluster, message=FALSE, cache=TRUE, eval=FALSE}
plotCluster(clusterResults)
```
